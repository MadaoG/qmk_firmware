/* #include "ergodox.h" */
#include QMK_KEYBOARD_H
#include "action_layer.h"
#include "keymap_extras/keymap_german.h"
#include "mousekey.h"
#include <stdbool.h>

#define _BS 0 // base layer
#define _EN 1 // english layer (base without äöüß)
#define _FW 2 // fast writing
#define _FE 3 // fast writing (english)
#define _SM 4 // symbol layer
#define _MV 5 // movement layer
#define _NM 6 // digit layer
#define _NS 7 // symbols for digit layer
#define _FN 8 // fn keys
#define _GM 9 // gaming layer
#define _MS 10 // mouse layer
#define _D  11 // empty (dumb) layer, may be useful as first reference

#define _______ KC_TRNS

#define PI 3.14159265358979323846

uint8_t last_layer = 0; // check if layer was changed
uint8_t n1, n2, n3 = 1; // brightness of leds 1, 2 and 3
uint16_t t = 0;         // time count for leds: 0 -- 1000

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
/*
    .---------------------------------------------------------.           .---------------------------------------------------------.
    | tg _fw  |   1   |   2   |   3   |   4   |   5   |   ´   |           |   `   |   6   |   7   |   8   |   9   |   0   |    L4   |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|-------|           |-------|-------|-------|-------|-------|-------|---------|
    | tg _ms  |   x   |   v   |   l   |   c   |   w   |       |           |       |   k   |   h   |   g   |   f   |   q   |    ß    |
    |         |       |       |       |       |       |   :   |           |   @   |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|       |           |       |-------|-------|-------|-------|-------|---------|
    |         |   u   |   i   |   a   |   e   |   o   |_______|           |_______|   s   |   n   |   r   |   t   |   d   |    y    |
    |  mo(1)  |       |       |  _sm  |  _nm  |       |       |           |       |       |  _mv  |  _sm  |       |       |  mo(1)  |
    |---------|-------|-------|-------|-------|-------|   _   |           |   \   |-------|-------|-------|-------|-------|---------|
    |   osm   |   ü   |   ö   |   ä   |   p   |   z   |       |           |       |   b   |   m   |   ,   |   .   |   j   |   osm   |
    |  l_sft  |       |  alt  | shift |  ctrl |       |       |           |       |       |  ctrl | shift |  alt  |       |  r_sft  |
    '---------|-------|-------|-------|-------|---------------'           '---------------|-------|-------|-------|-------|---------'
      |       | super |   up  |       |   :   |                                           |  esc  |  left | right |   up  |  down |
      |       |       |       | mo(3) |       |                                           |       |       |       |       |       |
      '---------------------------------------'                                           '---------------------------------------'
                                                 .---------------.     .---------------.
                                                 |       | vol   |     | r_sft | lock  |
                                                 |       |   up  |     |       |       |
                                         .-------|-------|-------|     |-------|-------|-------.
                                         |       |       | vol   |     |       |       |       |
                                         |       | back- |  down |     |       |       |       |
                                         |  tab  | space |-------|     |-------| enter | space |
                                         |       |       | vol   |     |  del  |       |       |
                                         |       |       |  mute |     |       |       |       |
                                         '-----------------------'     '-----------------------'
 */
[_BS] = KEYMAP(

 TG(_FW),            DE_1,               DE_2,             DE_3,              DE_4,             DE_5,               DE_ACUT,
 TG(_MS),            DE_X,               DE_V,             DE_L,              DE_C,             DE_W,               DE_COLN,
 TT(_SM),            DE_U,               DE_I,             LT(_SM,DE_A),      LT(_NM,DE_E),     DE_O,               /*---*/
 OSM(MOD_LSFT),      DE_UE,              ALT_T(DE_OE),     SFT_T(DE_AE),      CTL_T(DE_P),      DE_Z,               DE_UNDS,
 _______,            KC_LGUI,            KC_UP,            MO(_FN),           DE_COLN,          /*---*/             /*---*/
 //
 _______,            KC_VOLU,                              //
 KC_VOLD,                                                  // thumb      eys
 KC_TAB,             KC_BSPC,            KC_MUTE,          //
 //
 //
 DE_GRV,             DE_6,               DE_7,             DE_8,              DE_9,             DE_0,               TG(_GM),
 DE_AT,              DE_K,               DE_H,             DE_G,              DE_F,             DE_Q,               DE_SS,
 /*---*/             DE_S,               LT(_MV,DE_N),     LT(_SM,DE_R),      DE_T,             DE_D,               LT(_SM, DE_Y),
 DE_BSLS,            DE_B,               CTL_T(DE_M),      SFT_T(DE_COMM),    ALT_T(DE_DOT),    DE_J,               OSM(MOD_RSFT),
 /*---*/             /*---*/             KC_ESC,           KC_LEFT,           KC_RGHT,          KC_UP,              KC_DOWN,
 //
 KC_RSFT,            KC_LOCK,                              //
 _______,                                                  // thumb      eys
 KC_DEL,             KC_ENTER,           KC_SPACE          //
),

/*
 * fast writing layer:
 * remove ctrl, shift, alt etc. from homerow
 */
[_FW] = KEYMAP(
 _______,            DE_1,               DE_2,             DE_3,              DE_4,             DE_5,               DE_ACUT,
 _______,            DE_X,               DE_V,             DE_L,              DE_C,             DE_W,               DE_COLN,
 _______,            DE_U,               DE_I,             DE_A,              DE_E,             DE_O,               /*---*/
 _______,            DE_UE,              DE_OE,            DE_AE,             DE_P,             DE_Z,               DE_UNDS,
 _______,            KC_LGUI,            KC_UP,            MO(_FN),           DE_COLN,          /*---*/             /*---*/
 //
 KC_DEL,             KC_VOLU,                              //
 KC_VOLD,                                                  // thumb      eys
 KC_TAB,             KC_BSPC,            KC_MUTE,          //
 //
 //
 DE_GRV,             DE_6,               DE_7,             DE_8,              DE_9,             DE_0,               TG(_GM),
 DE_AT,              DE_K,               DE_H,             DE_G,              DE_F,             DE_Q,               DE_SS,
 /*---*/             DE_S,               DE_N,             DE_R,              DE_T,             DE_D,               LT(_SM, DE_Y),
 DE_BSLS,            DE_B,               DE_M,             DE_COMM,           DE_DOT,           DE_J,               OSM(MOD_RSFT),
 /*---*/             /*---*/             KC_ESC,           KC_LEFT,           KC_RGHT,          KC_UP,              KC_DOWN,
 //
 KC_RSFT,            KC_LOCK,                              //
 _______,                                                  // thumb      eys
 KC_DEL,             KC_ENTER,           KC_SPACE          //
),

/*
    .---------.-------.-------.-------.-------.-------.-------.           .-------.-------.-------.-------.-------.-------.---------.
    |    _    |   _   |   _   |   _   |   _   |   _   |   _   |           |   _   |   _   |   _   |   _   |   _   |   _   |    _    |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|-------|           |-------|-------|-------|-------|-------|-------|---------|
    |    _    |   _   |   _   |   _   |   _   |   _   |       |           |       |   _   |   _   |   _   |   _   |   _   |         |
    |         |       |       |       |       |       |   _   |           |   _   |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|       |           |       |-------|-------|-------|-------|-------|---------|
    |    _    |   _   |   _   |   _   |   _   |   _   |_______|           |_______|   _   |   _   |   _   |   _   |   _   |    _    |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|   _   |           |   _   |-------|-------|-------|-------|-------|---------|
    |    _    |       |   X   |   Q   |   _   |   _   |       |           |       |   _   |   _   |   _   |   _   |   _   |    _    |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    '---------|-------|-------|-------|-------|---------------'           '---------------|-------|-------|-------|-------|---------'
      |   _   |   _   |   _   |   _   |   _   |                                           |   _   |   _   |   _   |   _   |   _   |
      |       |       |       |       |       |                                           |       |       |       |       |       |
      '-------'-------'-------'-------'-------'                                           '-------'-------'-------'-------'-------'
                                                 .-------.-------.     .-------.-------.
                                                 |   _   |   _   |     |   _   |   _   |
                                                 |       |       |     |       |       |
                                         .-------|-------|-------|     |-------|-------|-------.
                                         |       |       |   _   |     |   _   |       |       |
                                         |       |       |       |     |       |       |       |
                                         |   _   |   _   |-------|     |-------|   _   |   _   |
                                         |       |       |   _   |     |   _   |       |       |
                                         |       |       |       |     |       |       |       |
                                         '-------'-------'-------'     '-------'-------'-------'
 *
 * Like BASE layer, but without umlaute.
 * Use x and q instead.
 */

 [_EN] = KEYMAP(
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,      _______,      /*---*/
 _______,      KC_NO,        KC_X,         KC_Q,         _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,
 _______,      _______,                         //
 _______,                                       // thumb keys
 _______,      _______,      _______,           //

 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,      _______,      KC_NO,
 /*---*/       _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 /*---*/       /*---*/       _______,      _______,      _______,      _______,      _______,
 _______,      _______,                         //
 _______,                                       // thumb keys
 _______,      _______,      _______            //
 ),
 
 

/*
    .---------------------------------------------------------.           .---------------------------------------------------------.
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|-------|           |-------|-------|-------|-------|-------|-------|---------|
    |         |       |   _   |   [   |   ]   |   ^   |       |           |       |   !   |   <   |   >   |   =   |   &   |         |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|       |           |       |-------|-------|-------|-------|-------|---------|
    |         |   \   |   /   |   {   |   }   |   *   |_______|           |_______|   ?   |   (   |   )   |   -   |   :   |    @    |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|       |           |       |-------|-------|-------|-------|-------|---------|
    |         |   #   |   $   |   |   |   ~   |       |       |           |       |   +   |   %   |   "   |   '   |   ;   |         |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    '---------|-------|-------|-------|-------|---------------'           '---------------|-------|-------|-------|-------|---------'
      |       |       |       |       |       |                                           |       |       |       |       |       |
      |       |       |       |       |       |                                           |       |       |       |       |       |
      '---------------------------------------'                                           '---------------------------------------'
                                                 .-------.-------.     .-------.-------.
                                                 |       |       |     |       |       |
                                                 |       |       |     |       |       |
                                         .-------|-------|-------|     |-------|-------|-------.
                                         |       |       |       |     |       |       |       |
                                         |       |       |       |     |       |       |       |
                                         |       |       |-------|     |-------|       |       |
                                         |       |       |       |     |       |       |       |
                                         |       |       |       |     |       |       |       |
                                         '-----------------------'     '-----------------------'
 */
[_SM] = KEYMAP(

 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      DE_UNDS,      DE_LBRC,      DE_RBRC,      M(1),      _______,
 _______,      DE_BSLS,      DE_SLSH,      DE_LCBR,      DE_RCBR,      DE_ASTR,
 _______,      DE_HASH,      DE_DLR,       DE_PIPE,      DE_TILD,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,
 _______,      _______,
 _______,
 _______,      _______,      _______,

 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      DE_EXLM,      DE_LESS,      DE_MORE,      DE_EQL,       DE_AMPR,      _______,
 /*---*/       DE_QST,       DE_LPRN,      DE_RPRN,      DE_MINS,      DE_COLN,      DE_AT,
 _______,      DE_PLUS,      DE_PERC,      DE_DQOT,      DE_QUOT,      DE_SCLN,      _______,
 /*---*/       /*---*/       _______,      _______,      _______,      _______,      _______,
 _______,      _______,
 _______,
 _______,      _______,      _______
),

/*
     .---------------------------------------------------------.         .-------.-------.-------.-------.-------.-------.---------.
     |         |       |       |       |       |       |       |         |   _   |   _   |   _   |   _   |   _   |   _   |    _    |
     |         |       |       |       |       |       |       |         |       |       |       |       |       |       |         |
     |---------|-------|-------|-------|-------|-------|-------|         |-------|-------|-------|-------|-------|-------|---------|
     |         | page  | back  |  up   |  del  | page  |       |         |       |   _   |   _   |   _   |   _   |   _   |    _    |
     |         |   up  |  space|       |       |  down |       |         |   _   |       |       |       |       |       |         |
     |---------|-------|-------|-------|-------|-------|       |         |       |-------|-------|-------|-------|-------|---------|
     |         | start | left  | down  | right |  end  |_______|         |_______|   _   |   _   |   _   |   _   |   _   |    _    |
     |         |       |       |       |       |       |       |         |       |       |       |       |       |       |         |
     |---------|-------|-------|-------|-------|-------|       |         |   _   |-------|-------|-------|-------|-------|---------|
     |         |       |       | prev  | next  |       |       |         |       |   _   |   _   |   _   |   _   |   _   |    _    |
     |         |       |       |       |       |       |       |         |       |       |       |       |       |       |         |
     '---------|-------|-------|-------|-------|---------------'         '---------------|-------|-------|-------|-------|---------'
       |       |       |       |       |       |                                         |   _   |   _   |   _   |   _   |   _   |
       |       |       |       |       |       |                                         |       |       |       |       |       |
       '---------------------------------------'                                         '-------'-------'-------'-------'-------'
                                                 .-------.-------.     .-------.-------.
                                                 |   _   |   _   |     |   _   |   _   |
                                                 |       |       |     |       |       |
                                         .-------|-------|-------|     |-------|-------|-------.
                                         |       |       |   _   |     |   _   |       |       |
                                         |       |       |       |     |       |       |       |
                                         |   _   |   _   |-------|     |-------|   _   |   _   |
                                         |       |       |   _   |     |   _   |       |       |
                                         |       |       |       |     |       |       |       |
                                         '-------'-------'-------'     '-------'-------'-------'
 */

 [_MV] = KEYMAP(
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      KC_PGUP,      KC_BSPC,      KC_UP,        KC_DEL,       KC_PGDN,      _______,
 _______,      KC_HOME,      KC_LEFT,      KC_DOWN,      KC_RGHT,      KC_END,       /*---*/
 _______,      _______,      _______,      KC_MPRV,      KC_MNXT,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,
 _______,      _______,                         //
 _______,                                       // thumb keys
 _______,      _______,      _______,           //

 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 /*---*/       _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 /*---*/       /*---*/       _______,      _______,      _______,      _______,      _______,
 _______,      _______,                         //
 _______,                                       // thumb keys
 _______,      _______,      _______            //
 ),
 
 

/*
     .---------.-------.-------.-------.-------.-------.-------.          .---------------------------------------------------------.
     |         |       |       |       |       |       |       |          |       |       |   (   |   *   |   )   |       |         |
     |         |       |       |       |       |       |       |          |       |       |       |       |       |       |         |
     |---------|-------|-------|-------|-------|-------|-------|          |-------|-------|-------|-------|-------|-------|---------|
     |         |       |       |       |       |       |       |          |       |   +   |   7   |   8   |   9   |   -   |         |
     |         |       |       |       |       |       |       |          |       |       |       |       |       |       |         |
     |---------|-------|-------|-------|-------|-------|       |          |       |-------|-------|-------|-------|-------|---------|
     |         |       |       |       |       |       |_______|          |_______|   .   |   4   |   5   |   6   |   :   |         |
     |         |       |       |       |       |       |       |          |       |       |       |       |       |       |         |
     |---------|-------|-------|-------|-------|-------|       |          |       |-------|-------|-------|-------|-------|---------|
     |         |       |       |       |       |       |       |          |       |   ,   |   1   |   2   |   3   |   /   |         |
     |         |       |       |       |       |       |       |          |       |       |       |       |       |       |         |
     '---------|-------|-------|-------|-------|---------------'          '---------------|-------|-------|-------|-------|---------'
       |       |       |       |       |       |                                          |   [   |       |   ]   |       |       |
       |       |       |       |       |       |                                          |       |       |       |       |       |
       '-------'-------'-------'-------'-------'                                          '---------------------------------------'
                                                 .-------.-------.     .-------.-------.
                                                 |       |       |     |       |       |
                                                 |       |       |     |       |       |
                                         .-------|-------|-------|     |-------|-------|-------.
                                         |       |       |       |     |       |       |       |
                                         |       |       |       |     |       |       |       |
                                         |       |       |-------|     |-------|       |   0   |
                                         |       |       |       |     |       |       |       |
                                         |       |       |       |     |       |       |       |
                                         '-----------------------'     '-----------------------'
 */

[_NM] = KEYMAP(

 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      TT(_NS),      _______,      _______,      /*---*/
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,
 _______,      _______,                         //
 _______,                                       // thumb keys
 _______,      _______,      _______,           //

 _______,      _______,      DE_LPRN,      DE_ASTR,      DE_RPRN,      _______,      _______,
 _______,      DE_PLUS,      DE_7,         DE_8,         DE_9,         DE_MINS,      _______,
 /*---*/       DE_DOT,       DE_4,         DE_5,         DE_6,         DE_COLN,      _______,
 _______,      DE_COMM,      DE_1,         DE_2,         DE_3,         DE_SLSH,      _______,
 /*---*/       /*---*/       DE_LBRC,      _______,      DE_RBRC,      _______,      _______,
 _______,      _______,                         //
 _______,                                       // thumb keys
 _______,      _______,      DE_0               //
),

/*
    .---------.-------.-------.-------.-------.-------.-------.           .-------.-------.-------.-------.-------.-------.---------.
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|-------|           |-------|-------|-------|-------|-------|-------|---------|
    |         |       |       |       |       |       |       |           |       |       |   {   |   }   |       |       |         |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|       |           |       |-------|-------|-------|-------|-------|---------|
    |         |       |       |       |       |       |_______|           |_______|       |   (   |   )   |       |       |         |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|       |           |       |-------|-------|-------|-------|-------|---------|
    |         |       |       |       |       |       |       |           |       |       |   [   |   ]   |       |       |         |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    '---------|-------|-------|-------|-------|---------------'           '---------------|-------|-------|-------|-------|---------'
      |       |       |       |       |       |                                           |       |       |       |       |       |
      |       |       |       |       |       |                                           |       |       |       |       |       |
      '-------'-------'-------'-------'-------'                                           '-------'-------'-------'-------'-------'
                                                 .-------.-------.     .-------.-------.
                                                 |       |       |     |       |       |
                                                 |       |       |     |       |       |
                                         .-------|-------|-------|     |-------|-------|-------.
                                         |       |       |       |     |       |       |       |
                                         |       |       |       |     |       |       |       |
                                         |       |       |-------|     |-------|       |       |
                                         |       |       |       |     |       |       |       |
                                         |       |       |       |     |       |       |       |
                                         '-------'-------'-------'     '-------'-------'-------'
 */

 [_NS] = KEYMAP(
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,      _______,      /*---*/
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,
 _______,      _______,                         //
 _______,                                       // thumb keys
 _______,      _______,      _______,           //

 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      DE_LCBR,      DE_RCBR,      _______,      _______,      _______,
 /*---*/       _______,      DE_LPRN,      DE_RPRN,      _______,      _______,      _______,
 _______,      _______,      DE_LBRC,      DE_RBRC,      _______,      _______,      _______,
 /*---*/       /*---*/       _______,      _______,      _______,      _______,      _______,
 _______,      _______,                         //
 _______,                                       // thumb keys
 _______,      _______,      _______            //
 ),

/*
    .---------.-------.-------.-------.-------.-------.-------.           .---------------------------------------------------------.
    |         |       |       |       |       |       |       |           |       |       |  F10  |  F11  |  F12  |       |         |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|-------|           |-------|-------|-------|-------|-------|-------|---------|
    |         |       |       |       |       |       |       |           |       |       |  F7   |  F8   |  F9   |       |         |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|       |           |       |-------|-------|-------|-------|-------|---------|
    |         |       |       |       |       |       |_______|           |_______|       |  F4   |  F5   |  F6   |       |         |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|       |           |       |-------|-------|-------|-------|-------|---------|
    |         |       |       |       |       |       |       |           |       |       |  F1   |  F2   |  F3   |       |         |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    '---------|-------|-------|-------|-------|---------------'           '---------------|-------|-------|-------|-------|---------'
      |       |       |       |       |       |                                           |       |       |       |       |       |
      |       |       |       |       |       |                                           |       |       |       |       |       |
      '-------'-------'-------'-------'-------'                                           '---------------------------------------'
                                                 .-------.-------.     .-------.-------.
                                                 |       |       |     |       |       |
                                                 |       |       |     |       |       |
                                         .-------|-------|-------|     |-------|-------|-------.
                                         |       |       |       |     |       |       |       |
                                         |       |       |       |     |       |       |       |
                                         |       |       |-------|     |-------|       |       |
                                         |       |       |       |     |       |       |       |
                                         |       |       |       |     |       |       |       |
                                         '-----------------------'     '-----------------------'
 */
[_FN] = KEYMAP(

 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,      _______,      /*---*/
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,
 _______,      _______,                         //
 _______,                                       // thumb keys
 _______,      _______,      _______,           //

 _______,      _______,      KC_F10,       KC_F11,       KC_F12,       _______,      _______,
 _______,      _______,      KC_F7,        KC_F8,        KC_F9,        _______,      _______,
 /*---*/       _______,      KC_F4,        KC_F5,        KC_F6,        _______,      _______,
 _______,      _______,      KC_F1,        KC_F2,        KC_F3,        _______,      _______,
 /*---*/       /*---*/       _______,      _______,      _______,      _______,      _______,
 _______,      _______,                         //
 _______,                                       // thumb keys
 _______,      _______,      _______            //
),

/*
    .---------.-------.-------.-------.-------.-------.-------.           .-------.-------.-------.-------.-------.-------.---------.
    |    _    |   _   |   _   |   _   |   _   |   _   |   _   |           |   _   |   _   |   _   |   _   |   _   |   _   |    _    |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|-------|           |-------|-------|-------|-------|-------|-------|---------|
    |    _    |   _   |   _   |   _   |   _   |   _   |       |           |       |   _   |   _   |   _   |   _   |   _   |    _    |
    |         |       |       |       |       |       |   _   |           |   _   |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|       |           |       |-------|-------|-------|-------|-------|---------|
    |    _    |   _   |   _   |   _   |   _   |   _   |_______|           |_______|   _   |   _   |   _   |   _   |   _   |    _    |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|   _   |           |   _   |-------|-------|-------|-------|-------|---------|
    |    _    |   _   |   _   |   _   |   _   |   _   |       |           |       |   _   |   _   |   _   |   _   |   _   |    _    |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    '---------|-------|-------|-------|-------|---------------'           '---------------|-------|-------|-------|-------|---------'
      |   _   |   _   |   _   |   _   |   _   |                                           |   _   |   _   |   _   |   _   |   _   |
      |       |       |       |       |       |                                           |       |       |       |       |       |
      '-------'-------'-------'-------'-------'                                           '-------'-------'-------'-------'-------'
                                                 .-------.-------.     .-------.-------.
                                                 |   _   |   _   |     |   _   |   _   |
                                                 |       |       |     |       |       |
                                         .-------|-------|-------|     |-------|-------|-------.
                                         |       |       |   _   |     |   _   |       |       |
                                         |       |       |       |     |       |       |       |
                                         |   _   |   _   |-------|     |-------|   _   |   _   |
                                         |       |       |   _   |     |   _   |       |       |
                                         |       |       |       |     |       |       |       |
                                         '-------'-------'-------'     '-------'-------'-------'
 */

[_MS] = KEYMAP(
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      KC_MS_U,      _______,      _______,      _______,
 _______,      _______,      KC_MS_L,      KC_MS_D,      KC_MS_R,      _______,      /*---*/
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,
 _______,      _______,                         //
 _______,                                       // thumb keys
 _______,      _______,      _______,           //

 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 /*---*/       _______,      KC_BTN1,      KC_BTN2,      KC_BTN3,      _______,      _______,
 _______,      _______,      KC_ACL0,      KC_ACL1,      KC_ACL2,      _______,      _______,
 /*---*/       /*---*/       _______,      _______,      _______,      _______,      _______,
 _______,      _______,                         //
 _______,                                       // thumb keys
 _______,      _______,      KC_RALT            //
),

/*
    .---------.-------.-------.-------.-------.-------.-------.           .-------.-------.-------.-------.-------.-------.---------.
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|-------|           |-------|-------|-------|-------|-------|-------|---------|
    |         |       |   b   |   n   |       |       |       |           |       |       |       |       |       |       |         |
    |         |       |       |       |       |       |   +   |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|       |           |       |-------|-------|-------|-------|-------|---------|
    |         |       |       |       | left  |repeat |_______|           |_______|       |       |       |       |       |         |
    |         |       |       |       |  click| click |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|   -   |           |       |-------|-------|-------|-------|-------|---------|
    |         |       |   m   | space |   z   |   p   |       |           |       |       |       |       |       |       |         |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    '---------|-------|-------|-------|-------|---------------'           '---------------|-------|-------|-------|-------|---------'
      |       |       |       |       |       |                                           |       |       |       |       |       |
      |       |       |       |       |       |                                           |       |       |       |       |       |
      '-------'-------'-------'-------'-------'                                           '-------'-------'-------'-------'-------'
                                                 .-------.-------.     .-------.-------.
                                                 |       |       |     |       |       |
                                                 |       |       |     |       |       |
                                         .-------|-------|-------|     |-------|-------|-------.
                                         |       |       |       |     |       |       |       |
                                         |       |       |       |     |       |       |       |
                                         |       |       |-------|     |-------|       |       |
                                         |       |       |       |     |       |       |       |
                                         |       |       |       |     |       |       |       |
                                         '-----------------------'     '-----------------------'
 */
[_GM] = KEYMAP(

 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      DE_B,         DE_N,         _______,      _______,      KC_PPLS,
 _______,      _______,      _______,      _______,      KC_BTN1,      M(0),
 _______,      _______,      DE_M,         KC_SPACE,     DE_Z,         DE_P,         KC_PMNS,
 _______,      _______,      _______,      _______,      _______,
 _______,      _______,                         //
 _______,                                       // thumb keys
 _______,      _______,      _______,           //

 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 /*---*/       _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 /*---*/       /*---*/       _______,      _______,      _______,      _______,      _______,
 _______,      _______,                         //
 _______,                                       // thumb keys
 _______,      _______,      _______            //
),

/*
    .---------.-------.-------.-------.-------.-------.-------.           .-------.-------.-------.-------.-------.-------.---------.
    |    _    |   _   |   _   |   _   |   _   |   _   |   _   |           |   _   |   _   |   _   |   _   |   _   |   _   |    _    |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|-------|           |-------|-------|-------|-------|-------|-------|---------|
    |    _    |   _   |   _   |   _   |   _   |   _   |       |           |       |   _   |   _   |   _   |   _   |   _   |    _    |
    |         |       |       |       |       |       |   _   |           |   _   |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|       |           |       |-------|-------|-------|-------|-------|---------|
    |    _    |   _   |   _   |   _   |   _   |   _   |_______|           |_______|   _   |   _   |   _   |   _   |   _   |    _    |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|   _   |           |   _   |-------|-------|-------|-------|-------|---------|
    |    _    |   _   |   _   |   _   |   _   |   _   |       |           |       |   _   |   _   |   _   |   _   |   _   |    _    |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    '---------|-------|-------|-------|-------|---------------'           '---------------|-------|-------|-------|-------|---------'
      |   _   |   _   |   _   |   _   |   _   |                                           |   _   |   _   |   _   |   _   |   _   |
      |       |       |       |       |       |                                           |       |       |       |       |       |
      '-------'-------'-------'-------'-------'                                           '-------'-------'-------'-------'-------'
                                                 .-------.-------.     .-------.-------.
                                                 |   _   |   _   |     |   _   |   _   |
                                                 |       |       |     |       |       |
                                         .-------|-------|-------|     |-------|-------|-------.
                                         |       |       |   _   |     |   _   |       |       |
                                         |       |       |       |     |       |       |       |
                                         |   _   |   _   |-------|     |-------|   _   |   _   |
                                         |       |       |   _   |     |   _   |       |       |
                                         |       |       |       |     |       |       |       |
                                         '-----------------------'     '-----------------------'
 */

[_D] = KEYMAP(
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,      _______,      /*---*/
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,
 _______,      _______,                         //
 _______,                                       // thumb keys
 _______,      _______,      _______,           //

 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 /*---*/       _______,      _______,      _______,      _______,      _______,      _______,
 _______,      _______,      _______,      _______,      _______,      _______,      _______,
 /*---*/       /*---*/       _______,      _______,      _______,      _______,      _______,
 _______,      _______,                         //
 _______,                                       // thumb keys
 _______,      _______,      _______            //
),

};

const uint16_t PROGMEM fn_actions[] = {};

#define UC_MODE_WIN 0
#define UC_MODE_LINUX 1
#define UC_MODE_OSX 2

// TODO: allow default mode to be configured
static uint16_t unicode_mode = UC_MODE_WIN;

uint16_t hextokeycode(uint8_t hex) {
    if (hex == 0x0) {
        return KC_P0;
    }
    if (hex < 0xA) {
        return KC_P1 + (hex - 0x1);
    }
    return KC_A + (hex - 0xA);
}

void unicode_action_function(uint16_t hi, uint16_t lo) {
    switch (unicode_mode) {
    case UC_MODE_WIN:
        register_code(KC_LALT);

        register_code(KC_PPLS);
        unregister_code(KC_PPLS);

        register_code(hextokeycode((hi & 0xF0) >> 4));
        unregister_code(hextokeycode((hi & 0xF0) >> 4));
        register_code(hextokeycode((hi & 0x0F)));
        unregister_code(hextokeycode((hi & 0x0F)));
        register_code(hextokeycode((lo & 0xF0) >> 4));
        unregister_code(hextokeycode((lo & 0xF0) >> 4));
        register_code(hextokeycode((lo & 0x0F)));
        unregister_code(hextokeycode((lo & 0x0F)));

        unregister_code(KC_LALT);
        break;
    case UC_MODE_LINUX:
        register_code(KC_LCTL);
        register_code(KC_LSFT);

        register_code(KC_U);
        unregister_code(KC_U);

        register_code(hextokeycode((hi & 0xF0) >> 4));
        unregister_code(hextokeycode((hi & 0xF0) >> 4));
        register_code(hextokeycode((hi & 0x0F)));
        unregister_code(hextokeycode((hi & 0x0F)));
        register_code(hextokeycode((lo & 0xF0) >> 4));
        unregister_code(hextokeycode((lo & 0xF0) >> 4));
        register_code(hextokeycode((lo & 0x0F)));
        unregister_code(hextokeycode((lo & 0x0F)));

        unregister_code(KC_LCTL);
        unregister_code(KC_LSFT);
        break;
    case UC_MODE_OSX:
        break;
    }
}

const macro_t *action_get_macro(keyrecord_t *record, uint8_t id, uint8_t opt) {

    if (record->event.pressed) {

      switch(id) {
        case 0:

          for (int i = 0; i < 25; i++) {
            mousekey_on(KC_BTN1);
            mousekey_send();
            wait_ms(10);
            mousekey_off(KC_BTN1);
            mousekey_send();
            wait_ms(10);
          }

          break;

        case 1:
          register_code(DE_CIRC);
          unregister_code(DE_CIRC);

          register_code(DE_CIRC);
          unregister_code(DE_CIRC);
          break;
      }
    }

    return MACRO_NONE;
};

// Runs just one time when the keyboard initializes.
void matrix_init_user(void) {

};

int normal_pdf(int x, int A, int m, int s)
{
    return (int)floor(A * exp(-0.5 * (x - m) * (x - m) / (s * s)));
}

void sset_1(int n1)
{
  if (n1 == 0) {
    ergodox_right_led_1_off();
  } else {
    ergodox_right_led_1_on();
    ergodox_right_led_1_set(n1);
  }
}

void sset_2(int n2)
{
  if (n2 == 0) {
    ergodox_right_led_2_off();
  } else {
    ergodox_right_led_2_on();
    ergodox_right_led_2_set(n2);
  }
}

void sset_3(int n3)
{
  if (n3 == 0) {
    ergodox_right_led_3_off();
  } else {
    ergodox_right_led_3_on();
    ergodox_right_led_3_set(n3);
  }
}

void ll1(void)
{
  n1 = normal_pdf(t, 255, 500, 100);
  sset_1(n1);
}

void ll2(void)
{
  n2 = normal_pdf(t, 255, 500, 100);
  sset_2(n2);
}

void ll3(void)
{
  n3 = normal_pdf(t, 255, 500, 100);
  sset_3(n3);
}

void ll12(void)
{
  n1 = normal_pdf(t, 255, 400, 100);
  n2 = normal_pdf(t, 255, 600, 100);
  sset_1(n1);
  sset_2(n2);
}

void ll13(void)
{
  n1 = normal_pdf(t, 255, 400, 100);
  n3 = normal_pdf(t, 255, 600, 100);
  sset_1(n1);
  sset_3(n3);
}

void ll23(void)
{
  n2 = normal_pdf(t, 255, 400, 100);
  n3 = normal_pdf(t, 255, 600, 100);
  sset_2(n2);
  sset_3(n3);
}

void ll123(void)
{
  n1 = normal_pdf(t, 255, 400, 100);
  n2 = normal_pdf(t, 255, 500, 100);
  n3 = normal_pdf(t, 255, 600, 100);
  sset_1(n1);
  sset_2(n2);
  sset_3(n3);
}

void ll321(void)
{
  n3 = normal_pdf(t, 255, 400, 100);
  n2 = normal_pdf(t, 255, 500, 100);
  n1 = normal_pdf(t, 255, 600, 100);
  sset_1(n1);
  sset_2(n2);
  sset_3(n3);
}







LEADER_EXTERNS();
// Runs constantly in the background, in a loop.
void matrix_scan_user(void) {
    uint8_t layer = biton32(layer_state);
    t++;
    if (t >= 1000) {
      t = 0;
    }

    if (layer == last_layer) {
      // update leds
      switch (layer) {
        case _BS:
          ll1();
          break;
        case _EN:
          // pass
          break;
        case _FW:
          // pass
          break;
        case _FE:
          // pass
          break;
        case _SM:
          ll2();
          break;
        case _MV:
          // pass
          break;
        case _NM:
          ll3();
          break;
        case _NS:
          // pass
          break;
        case _FN:
          // pass
          break;
        case _GM:
          ll123();
          break;
        case _MS:
          ll12();
          break;
        case _D :
          // pass
          break;
        default:
          ergodox_board_led_off();
      }
    } else {
      last_layer = layer;
      t = 0;
      // init leds
      ergodox_board_led_off();
      ergodox_right_led_1_off();
      ergodox_right_led_2_off();
      ergodox_right_led_3_off();
    }
};


/*
    .---------.-------.-------.-------.-------.-------.-------.           .-------.-------.-------.-------.-------.-------.---------.
    |    _    |   _   |   _   |   _   |   _   |   _   |   _   |           |   _   |   _   |   _   |   _   |   _   |   _   |    _    |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|-------|           |-------|-------|-------|-------|-------|-------|---------|
    |    _    |   _   |   _   |   _   |   _   |   _   |       |           |       |   _   |   _   |   _   |   _   |   _   |    _    |
    |         |       |       |       |       |       |   _   |           |   _   |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|       |           |       |-------|-------|-------|-------|-------|---------|
    |    _    |   _   |   _   |   _   |   _   |   _   |_______|           |_______|   _   |   _   |   _   |   _   |   _   |    _    |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    |---------|-------|-------|-------|-------|-------|   _   |           |   _   |-------|-------|-------|-------|-------|---------|
    |    _    |   _   |   _   |   _   |   _   |   _   |       |           |       |   _   |   _   |   _   |   _   |   _   |    _    |
    |         |       |       |       |       |       |       |           |       |       |       |       |       |       |         |
    '---------|-------|-------|-------|-------|---------------'           '---------------|-------|-------|-------|-------|---------'
      |   _   |   _   |   _   |   _   |   _   |                                           |   _   |   _   |   _   |   _   |   _   |
      |       |       |       |       |       |                                           |       |       |       |       |       |
      '-------'-------'-------'-------'-------'                                           '-------'-------'-------'-------'-------'
                                                 .-------.-------.     .-------.-------.
                                                 |   _   |   _   |     |   _   |   _   |
                                                 |       |       |     |       |       |
                                         .-------|-------|-------|     |-------|-------|-------.
                                         |       |       |   _   |     |   _   |       |       |
                                         |       |       |       |     |       |       |       |
                                         |   _   |   _   |-------|     |-------|   _   |   _   |
                                         |       |       |   _   |     |   _   |       |       |
                                         |       |       |       |     |       |       |       |
                                         '-------'-------'-------'     '-------'-------'-------'
 */

 // [_] = KEYMAP(
 // _______,      _______,      _______,      _______,      _______,      _______,      _______,
 // _______,      _______,      _______,      _______,      _______,      _______,      _______,
 // _______,      _______,      _______,      _______,      _______,      _______,      /*---*/
 // _______,      _______,      _______,      _______,      _______,      _______,      _______,
 // _______,      _______,      _______,      _______,      _______,
 // _______,      _______,                         //
 // _______,                                       // thumb keys
 // _______,      _______,      _______,           //

 // _______,      _______,      _______,      _______,      _______,      _______,      _______,
 // _______,      _______,      _______,      _______,      _______,      _______,      _______,
 // /*---*/       _______,      _______,      _______,      _______,      _______,      _______,
 // _______,      _______,      _______,      _______,      _______,      _______,      _______,
 // /*---*/       /*---*/       _______,      _______,      _______,      _______,      _______,
 // _______,      _______,                         //
 // _______,                                       // thumb keys
 // _______,      _______,      _______            //
 // ),
 
 
